<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scribbly — Save Your Notes</title>
  <meta name="description" content="Scribbly: write, save, and delete notes with localStorage. Online note website application" />
  <meta name="theme-color" content="#CC1A7D" />
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="icon.png">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="manifest" href="manifest.json" />
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <span class="logo" aria-hidden="true">✏️</span>
      <h1>Scribbly</h1>
    </div>
    <div class="header-actions">
      <button id="newNoteBtn" class="btn">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 5v14"></path>
            <path d="M5 12h14"></path>
          </svg>
        </span>
        <span class="label">New Note</span>
      </button>
      <button id="installBtn" class="btn" hidden>
        <span class="label">Install App</span>
      </button>
    </div>
  </header>

  <main class="app">
    <aside class="sidebar">
      <div class="search">
        <input id="searchInput" type="text" placeholder="Search notes…" aria-label="Search notes" />
      </div>
      <ul id="notesList" class="notes-list" aria-label="Notes list"></ul>
    </aside>

    <section class="editor" aria-label="Note editor">
      <input id="noteTitle" type="text" placeholder="Title" aria-label="Note title" />
      <textarea id="noteContent" placeholder="Write your note here…" aria-label="Note content"></textarea>
      <div class="editor-toolbar">
        <button id="infoBtn" class="btn" type="button" aria-label="About & Help">
          <span class="icon" aria-hidden="true">!</span>
        </button>
        <span id="status" class="status" role="status" aria-live="polite"></span>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <small>Works offline. Installable. Your notes stay on this device.</small>
  </footer>

  <div id="contextMenu" class="context-menu" hidden>
    <button id="contextPin" class="item" type="button">Pin/Unpin</button>
    <button id="contextDelete" class="item danger" type="button">Delete</button>
  </div>
  <!-- Hidden button for manual date/time editing; not visible but clickable via status text -->
  <button id="editDateBtn" type="button" hidden aria-hidden="true"></button>

  <!-- About / Help Modal -->
  <div id="aboutModal" class="modal-overlay" hidden role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
    <div class="modal">
      <div class="modal-header">
        <h2 id="aboutTitle">About Scribbly</h2>
        <button id="aboutClose" class="modal-close" type="button" aria-label="Close">×</button>
      </div>
      <div class="modal-body">
        <p>Scribbly is a simple lightweight notes app that works even when you’re offline.</p>
        <p>Your notes are saved on this device. No account, no cloud.</p>
        <p>Tips:</p>
        <ul>
          <li>Click <strong>New Note</strong> to start writing.</li>
          <li>Select a note to open it; changes save automatically.</li>
          <li>Use the <strong>search</strong> box to filter notes by title or content.</li>
          <li>Right‑click a note to <strong>Pin</strong> or <strong>Delete</strong>.</li>
          <li><strong>Install:</strong> Click <em>Install App</em> (when shown) or use your browser’s “Install”, “Add to Home Screen”.</li>
          <li><strong>Offline:</strong> The app works without internet. The header shows your status.</li>
        </ul>
        <p>If you clear your browser’s site data, your notes will be removed.</p>
      </div>
    </div>
  </div>
  <script src="script.js"></script>
  <script>
    // Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.error);
      });
    }

    // Install prompt handling and visibility based on install status
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    function isAppInstalled() {
      const standalone = window.matchMedia('(display-mode: standalone)').matches || (navigator.standalone === true);
      const flag = localStorage.getItem('scribbly.installed') === 'true';
      return standalone || flag;
    }

    function updateInstallVisibility() {
      if (!installBtn) return;
      installBtn.hidden = isAppInstalled();
      installBtn.disabled = false;
      const label = installBtn.querySelector('.label');
      if (label) label.textContent = 'Install App';
      installBtn.classList.remove('primary');
    }

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      updateInstallVisibility();
    });

    window.addEventListener('appinstalled', () => {
      localStorage.setItem('scribbly.installed', 'true');
      if (!installBtn) return;
      const label = installBtn.querySelector('.label');
      if (label) label.textContent = 'Installed ✓';
      installBtn.classList.add('primary');
      installBtn.hidden = false; // show success feedback briefly even if we will hide later
      installBtn.disabled = true;
      setTimeout(() => {
        if (label) label.textContent = 'Install App';
        installBtn.classList.remove('primary');
        installBtn.disabled = false;
        updateInstallVisibility(); // hide because installed
      }, 3000);
    });

    installBtn && installBtn.addEventListener('click', async () => {
      if (isAppInstalled()) { updateInstallVisibility(); return; }
      if (!deferredPrompt) {
        // No prompt available; show brief hint
        const label = installBtn.querySelector('.label');
        const prev = label ? label.textContent : '';
        if (label) label.textContent = 'Install not available';
        installBtn.disabled = true;
        setTimeout(() => {
          if (label) label.textContent = prev || 'Install App';
          installBtn.disabled = false;
        }, 3000);
        return;
      }
      installBtn.disabled = true;
      try {
        await deferredPrompt.prompt();
      } catch (_) {
        // ignore
      } finally {
        installBtn.disabled = false;
        deferredPrompt = null;
      }
    });

    // Set initial button visibility on load
    updateInstallVisibility();
  </script>
</body>
</html>